# name: test/sql/tpch/tpch.test
# description: Run TPC-H queries over MongoDB collections
# group: [tpch]

#
# IMPORTANT: This test uses a separate test database (tpch_test) that is always sf=0.01.
# The expected results are from duckdb/extension/tpch/dbgen/answers/sf0.01/
# 
# To set up the test database, run:
#   test/create-tpch-test-db.sh

require tpch

require mongo

require-env MONGODB_TEST_DATABASE_AVAILABLE

statement ok
ATTACH 'host=localhost port=27017 database=tpch_test' AS tpch_mongo (TYPE MONGO);

# Set search path so PRAGMA tpch() queries can find the tables
statement ok
SET search_path='tpch_mongo.tpch';

# Run TPC-H queries 1-9
loop i 1 9

query I
PRAGMA tpch(${i})
----
<FILE>:duckdb/extension/tpch/dbgen/answers/sf0.01/q0${i}.csv

endloop

# Run TPC-H queries 10-22
loop i 10 22

query I
PRAGMA tpch(${i})
----
<FILE>:duckdb/extension/tpch/dbgen/answers/sf0.01/q${i}.csv

endloop

# Cleanup - reset search path (test framework handles cleanup)
statement ok
SET search_path='main';

